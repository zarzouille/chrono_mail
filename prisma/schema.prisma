generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id       String  @id @default(cuid())
  email    String  @unique
  name     String?
  password String
  plan     Plan    @default(FREE)

  // Stripe
  stripeCustomerId       String?   @unique
  stripeSubscriptionId   String?   @unique
  stripePriceId          String?
  stripeCurrentPeriodEnd DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  countdowns  Countdown[]
  impressions Impression[]
}

model Countdown {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  name     String
  endDate  DateTime
  timezone String   @default("Europe/Paris")

  bgColor   String @default("#ffffff")
  textColor String @default("#2563eb")
  fontSize  Int    @default(36)
  width     Int    @default(400)

  expiredBehavior ExpiredBehavior @default(SHOW_ZEROS)
  expiredText     String?
  expiredImageUrl String?
  clickUrl        String?

  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  impressions Impression[]

  @@index([userId])
}

model Impression {
  id          String    @id @default(cuid())
  countdownId String
  countdown   Countdown @relation(fields: [countdownId], references: [id], onDelete: Cascade)
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  userAgent String?
  ip        String?

  @@index([countdownId])
  @@index([userId])
  @@index([createdAt])
}

enum Plan {
  FREE
  PRO
  BUSINESS
}

enum ExpiredBehavior {
  SHOW_ZEROS
  SHOW_TEXT
  SHOW_IMAGE
  HIDE
}
